/*! jquery.pep - v0.3.0 - 2012-12-07
* pep.briangonzalez.org
* Copyright (c) 2012 Brian Gonzalez; Licensed MIT */
(function(e,t,n){function o(n,r){this.el=n,this.$el=e(n),this.options=e.extend({},s,r),this.$document=e(i),this.$window=e(t),this._defaults=s,this._name="Pep",this.moveTrigger=this.isTouch()?"touchmove":"mousemove",this.startTrigger=this.isTouch()?"touchstart":"mousedown",this.stopTrigger=this.isTouch()?"touchend":"mouseup",this.stopEvents=[this.stopTrigger,this.options.stopEvents].join(" "),this.$container=this.options.constrainToParent?this.$el.parent():this.$document,this.CSSEaseHash=this.getCSSEaseHash(),this.velocityQueue=new Array(5),this.scale=1,this.disabled=!1,this.init()}var r="pep",i=t.document,s={debug:!1,activeClass:"active",multiplier:1,shouldPreventDefault:!0,stopEvents:"",hardwareAccelerate:!0,useCSSTranslation:!1,disableSelect:!0,cssEaseString:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",cssEaseDuration:750,shouldEase:!0,constrainToWindow:!1,constrainToParent:!1,axis:null,forceNonCSS3Movement:!1,drag:function(){},start:function(){},stop:function(){},rest:function(){}};o.prototype.init=function(){var e=this;this.options.hardwareAccelerate&&this.hardwareAccelerate(),this.options.debug&&this.buildDebugDiv(),this.options.disableSelect&&this.disableSelect(),this.ev={},this.pos={},this.placeObject(),this.subscribe()},o.prototype.subscribe=function(){var e=this;this.$el.bind(this.startTrigger,function(t){e.handleStart(t)}),this.$document.bind(this.stopEvents,function(t){e.handleStop(t)}),this.$document.bind(this.moveTrigger,function(t){e.moveEvent=t})},o.prototype.handleStart=function(t){var n=this;this.isValidMoveEvent(t)&&!this.disabled&&(this.log({type:"event",event:t.type}),this.options.start(t,this),this.$el.addClass(this.options.activeClass),this.removeCSSEasing(),this.ev.x=this.isTouch()?t.originalEvent.pageX:t.pageX,this.ev.y=this.isTouch()?t.originalEvent.pageY:t.pageY,this.moveEvent=t,this.active=!0,this.options.shouldPreventDefault&&t.preventDefault(),function r(){if(!n.active)return;n.handleMove(),n.requestAnimationFrame(r)}(e,n))},o.prototype.handleMove=function(){var e=this.moveEvent;if(typeof e=="undefined")return;var t=this.isTouch()?e.originalEvent.touches[0].pageX:e.pageX,n=this.isTouch()?e.originalEvent.touches[0].pageY:e.pageY;this.addToLIFO({time:e.timeStamp,x:t,y:n});var r,i;e.type==this.startTrigger?(r=0,i=0):(r=t-this.ev.x,i=n-this.ev.y),this.ev.x=t,this.ev.y=n;if(r===0&&i===0){this.log({type:"event",event:"** stopped **"});return}this.options.drag(e,this),this.log({type:"event",event:e.type}),this.log({type:"event-coords",x:this.ev.x,y:this.ev.y}),this.log({type:"velocity"});var s=this.handleConstraint(r,i);if(!this.shouldUseCSSTranslation()){var o=r>=0?"+="+Math.abs(r/this.scale)*this.options.multiplier:"-="+Math.abs(r/this.scale)*this.options.multiplier,u=i>=0?"+="+Math.abs(i/this.scale)*this.options.multiplier:"-="+Math.abs(i/this.scale)*this.options.multiplier;if(this.options.constrainToParent||this.options.constrainToWindow)o=s.x!==!1?s.x:o,u=s.y!==!1?s.y:u;this.moveTo(o,u)}else{r=r/this.scale*this.options.multiplier,i=i/this.scale*this.options.multiplier;if(this.options.constrainToParent||this.options.constrainToWindow)r=s.x===!1?r:0,i=s.y===!1?i:0;this.moveToUsingTransforms(r,i)}},o.prototype.handleStop=function(e){if(!this.active)return;this.log({type:"event",event:e.type}),this.active=!1,this.options.shouldEase&&this.ease(e),this.options.stop(e,this),this.velocityQueue=new Array(5)},o.prototype.moveTo=function(e,t,n){n=n===!1||typeof n=="undefined"?!1:!0,this.options.axis==="x"?t="+=0":this.options.axis==="y"&&(e="+=0");var r=300;this.log({type:"delta",x:e,y:t}),n?this.$el.animate({top:t,left:e},r,"easeOutCirc",{queue:!1}):this.$el.stop(!0,!1).css({top:t,left:e})},o.prototype.moveToUsingTransforms=function(e,t){this.options.axis==="x"?t=0:this.options.axis==="y"&&(e=0),this.cssX=this.cssX?this.cssX+e:e,this.cssY=this.cssY?this.cssY+t:t,this.log({type:"delta",x:e,y:t}),this.translation="translate("+this.cssX+"px, "+this.cssY+"px)",this.$el.css({"-webkit-transform":this.translation,"-moz-transform":this.translation,"-ms-transform":this.translation,"-o-transform":this.translation,transform:this.translation})},o.prototype.addToLIFO=function(e){var t=this.velocityQueue;t=t.slice(1,t.length),t.push(e),this.velocityQueue=t},o.prototype.ease=function(e){var t=this.$el.position(),n=this.velocity(),r=this.dt,i=n.x/this.scale*this.options.multiplier,s=n.y/this.scale*this.options.multiplier,o=this.handleConstraint(i,s);this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash());var u=n.x>0?"+="+i:"-="+Math.abs(i),a=n.y>0?"+="+s:"-="+Math.abs(s);if(this.options.constrainToParent||this.options.constrainToWindow)u=o.x!==!1?o.x:u,a=o.y!==!1?o.y:a;var f=!this.cssAnimationsSupported()||this.options.forceNonCSS3Movement;this.moveTo(u,a,f);var l=this;this.timeout=setTimeout(function(){l.options.rest(e,l),l.$el.removeClass(l.options.activeClass)},this.options.cssEaseDuration)},o.prototype.velocity=function(){var e=0,t=0;for(var n=0;n<this.velocityQueue.length-1;n++)this.velocityQueue[n]&&(e+=this.velocityQueue[n+1].x-this.velocityQueue[n].x,t+=this.velocityQueue[n+1].y-this.velocityQueue[n].y,this.dt=this.velocityQueue[n+1].time-this.velocityQueue[n].time);var r=1.6;return{x:e*r,y:t*r}},o.prototype.requestAnimationFrame=function(e){return t.requestAnimationFrame&&t.requestAnimationFrame(e)||t.webkitRequestAnimationFrame&&t.webkitRequestAnimationFrame(e)||t.mozRequestAnimationFrame&&t.mozRequestAnimationFrame(e)||t.oRequestAnimationFrame&&t.mozRequestAnimationFrame(e)||t.msRequestAnimationFrame&&t.msRequestAnimationFrame(e)||t.setTimeout(e,1e3/60)},o.prototype.placeObject=function(){this.options.constrainToParent?this.$container.css({position:"relative"}):this.$container.css({position:"static"});var e=this.options.constrainToParent?"position":"offset";this.offset=this.$el[e](),this.$el.css({position:"absolute",top:this.offset.top,left:this.offset.left,zIndex:1})},o.prototype.setScale=function(e){this.scale=e},o.prototype.setMultiplier=function(e){this.options.multiplier=e},o.prototype.removeCSSEasing=function(){this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash(!0))},o.prototype.disableSelect=function(){this.$el.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})},o.prototype.handleConstraint=function(e,t){var n=this.$el.position();this.pos.x=n.left,this.pos.y=n.top,this.log({type:"pos-coords",x:this.pos.x,y:this.pos.y});var r=this.$container.width()-this.$el.outerWidth(),i=this.$container.height()-this.$el.outerHeight(),s={x:!1,y:!1};return this.pos.x+e>r&&(s.x=r),this.pos.x+e<0&&(s.x=0),this.pos.y+t>i&&(s.y=i),this.pos.y+t<0&&(s.y=0),s},o.prototype.getCSSEaseHash=function(e){typeof e=="undefined"&&(e=!1);if(e)var t="";else{if(this.CSSEaseHash)return this.CSSEaseHash;var t=["all",this.options.cssEaseDuration+"ms",this.options.cssEaseString].join(" ")}return{"-webkit-transition":t,"-moz-transition":t,"-ms-transition":t,"-o-transition":t,transition:t}},o.prototype.isTouch=function(e){return typeof Modernizr!="undefined"?Modernizr.touch:"ontouchstart"in t||t.DocumentTouch&&i instanceof DocumentTouch?!0:!1},o.prototype.isValidMoveEvent=function(e){return!this.isTouch()||this.isTouch()&&e.originalEvent.hasOwnProperty("touches")&&e.originalEvent.touches.length==1?!0:!1},o.prototype.shouldUseCSSTranslation=function(){if(typeof this.useCSSTranslation!="undefined")return this.useCSSTranslation;var e=!1;return!this.options.useCSSTranslation||typeof Modernizr!="undefined"&&!Modernizr.csstransforms?e=!1:e=!0,this.useCSSTranslation=e,e},o.prototype.cssAnimationsSupported=function(){if(typeof this.cssAnimationsSupport!="undefined")return this.cssAnimationsSupport;if(typeof Modernizr!="undefined"&&Modernizr.cssanimations)return this.cssAnimationsSupport=!0,!0;var e=!1,t=i.createElement("div"),r="animation",s="",o="Webkit Moz O ms Khtml".split(" "),u="";t.style.animationName&&(e=!0);if(e===!1)for(var a=0;a<o.length;a++)if(t.style[o[a]+"AnimationName"]!==n){u=o[a],r=u+"Animation",s="-"+u.toLowerCase()+"-",e=!0;break}return this.cssAnimationsSupport=e,e},o.prototype.hardwareAccelerate=function(){this.$el.css({"-webkit-transform":"translateZ(0)",transform:"translateZ(0)","-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})},o.prototype.getMovementValues=function(){return{ev:this.ev,pos:this.pos,velocity:this.velocity()}},o.prototype.buildDebugDiv=function(){if(e("#pep-debug").length===0){var t=e("<div></div>");t.attr("id","pep-debug").append("<div style='font-weight:bold; background: red; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({position:"fixed",bottom:5,right:5,zIndex:99999,textAlign:"right",fontFamily:"Arial, sans",fontSize:10,border:"1px solid #DDD",padding:"3px",background:"white",color:"#333"})}var n=this;setTimeout(function(){n.debugElements={$event:e("#pep-debug-event"),$velocityX:e("#pep-debug-velocity .pep-x"),$velocityY:e("#pep-debug-velocity .pep-y"),$dX:e("#pep-debug-delta .pep-x"),$dY:e("#pep-debug-delta .pep-y"),$evCoordsX:e("#pep-debug-ev-coords .pep-x"),$evCoordsY:e("#pep-debug-ev-coords .pep-y"),$posCoordsX:e("#pep-debug-pos-coords .pep-x"),$posCoordsY:e("#pep-debug-pos-coords .pep-y")}},0),e("body").append(t)},o.prototype.log=function(e){if(!this.options.debug)return;switch(e.type){case"event":this.debugElements.$event.text(e.event);break;case"pos-coords":this.debugElements.$posCoordsX.text(e.x),this.debugElements.$posCoordsY.text(e.y);break;case"event-coords":this.debugElements.$evCoordsX.text(e.x),this.debugElements.$evCoordsY.text(e.y);break;case"delta":this.debugElements.$dX.text(e.x),this.debugElements.$dY.text(e.y);break;case"velocity":var t=this.velocity();this.debugElements.$velocityX.text(Math.round(t.x)),this.debugElements.$velocityY.text(Math.round(t.y))}},e.extend(e.easing,{easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n}}),o.prototype.toggle=function(e){typeof e=="undefined"?this.disabled=!this.disabled:this.disabled=!e},e.fn[r]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+r)){var n=new o(this,t);e.data(this,"plugin_"+r,n),e.pep.peps.push(n)}})},e.pep={},e.pep.peps=[],e.pep.toggleAll=function(t){e.each(this.peps,function(e,n){n.toggle(t)})}})(jQuery,window);